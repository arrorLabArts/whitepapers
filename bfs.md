# Bitcoin File System (BFS) Protocol

## Table of Contents

1.  [Introduction](https://docs.google.com/document/d/10Y6b6jWECG-hIDvCNYUnMGrev5jPPsYmlrtk_w5Mv2k/edit#heading=h.b4cg8fao7emt)
    
2.  [Types of Data Nodes](https://docs.google.com/document/d/10Y6b6jWECG-hIDvCNYUnMGrev5jPPsYmlrtk_w5Mv2k/edit#heading=h.dqu59hj95t4h)
    
3.  [Motivation](https://docs.google.com/document/d/10Y6b6jWECG-hIDvCNYUnMGrev5jPPsYmlrtk_w5Mv2k/edit#heading=h.lpasspsa9pym)
    
4.  [OP_RETURN Payload Specification](https://docs.google.com/document/d/10Y6b6jWECG-hIDvCNYUnMGrev5jPPsYmlrtk_w5Mv2k/edit#heading=h.134kqyflkomd)
    
5.  [Sighash Preimage](https://docs.google.com/document/d/10Y6b6jWECG-hIDvCNYUnMGrev5jPPsYmlrtk_w5Mv2k/edit#heading=h.kyfnfy5mhnjc)
    
6.  [Conclusion](https://docs.google.com/document/d/10Y6b6jWECG-hIDvCNYUnMGrev5jPPsYmlrtk_w5Mv2k/edit#heading=h.yvf03cakdnp9)
    

## Introduction

Bitcoin File System (BFS) is a protocol for storing binary data in a tree data structure within Bitcoin OP_RETURN transaction outputs. Each node in the BFS tree represents metadata and also holds the actual content. Each node points to a particular root node, which represents the root of the filesystem. Additionally, each node also contains a reference to a parent node.

## Types of Data Nodes

There are two types of data nodes in the BFS protocol:

1.  <b>File node</b> : A leaf node that doesn't have any children, unlike directory nodes. Each file node must refer to a parent node, which is a directory node.
    
2.  <b>Directory node</b> : A non-leaf node that has children nodes.
    

## Motivation

The BFS protocol is designed primarily for storing data in an OP_RETURN output such that it could be represented as a file system tree. The protocol was also designed to cryptographically verify ownership of the data and the entire file system tree by a third party. Additionally, the protocol supports data encryption.

## OP_RETURN Payload Specification

The OP_RETURN data generated by this function consists of several parts:

1.  <b>Protocol Prefix</b> : A string that represents the protocol being used. It is specified in utf8 as "BFS".
    
2.  <b>Protocol Version</b> : A single byte that represents the version of the protocol being used. The current valid protocol version is 1.
    
3.  <b>BFS Payload</b> : The main payload that contains the metadata. It is constructed by concatenating the various buffers that represent the metadata values in the input map object.
    
4.  <b>Separator</b> : A single byte (0x1E) that is used to separate the different metadata values in the BFS Payload.
    
5.  <b>Null</b> : A single byte null character "\0" used to represent Null value.
    
6.  <b>Sighash PreImage</b> : A byte array of node metadata hashed with SHA256 to generate a fingerprint of the node.
    

BFS payload representation (s represents separator):

    <rootNodeId><s><nodeId><s><parentNodeId><s><type><s><accessType><s><name><s><description><s><extension><s><contentLength><s><mimeType><s><createdAt><s><fingerprint><s><sigOwner><s><ownerKey><s><sigPlatform><s><platformKey>

With the BFS payload combined, the OP_RETURN payload would look like this:

    op_return<protocol prefix><protocol version><bfs payload>

## Sighash PreImage

The Sighash Preimage is generated by concatenating the buffers of these keys without any separator.

    <rootNodeId><nodeId><parentNodeId><type><accessType><name><description><extension><contentLength><mimeType><createdAt>

1.  <b>rootNodeId</b> : Represents the root node ID of the metadata. It's a SHA256 digest of the ownerKey used to sign all children nodes. This field is not nullable.
    
2.  <b>nodeId</b>: 32 bytes random alphanumeric string. This field is not nullable.
    
3.  <b>parentNodeId</b>: 32 bytes random alphanumeric string. This field is not nullable.
    
4.  <b>type</b> : 1 byte unsigned integer. The value can be either 0 or 1. This field is not nullable. 0 represents a directory node; 1 represents a document or file node.
    
5.  <b>accessType</b> : 1 byte unsigned integer. The value can either be 0 or 1. This field is not nullable. 1 represents encrypted node content; 0 represents non-encrypted node content.
    

6. <b>name</b>: Alphanumeric String representing the node. This field is not nullable.

7.  <b>description</b> : Alphanumeric string containing a description of the node. This field is nullable.
    
8.  <b>extension</b> : Alphanumeric string containing the file extension information. This field is nullable.
    
9.  <b>contentLength</b> : 64 bytes unsigned integer in big-endian format, containing the length of the node content. This field is nullable.
    
10.  <b>mimeType</b> : Alphanumeric string containing the MIME type of the node content. This field is nullable.
    
11.  <b>createdAt</b> : 64 bytes unsigned integer in big-endian format, containing a Unix timestamp. This field is not nullable.
    
12.  <b>fingerprint</b> : SHA256 hash digest of the Sighash Preimage. This field is not nullable.
    
13.  <b>sigOwner</b> : ECIES signature of the node owner. Fingerprint is the message that is signed. This field is not nullable.
    
14.  <b>ownerKey</b> : ECDSA public key of the node owner. The SHA256 digest of the ownerKey must match the rootNodeId. This field is not nullable.
    
15.  <b>sigPlatform</b> : ECIES signature of the platform used to create the node. The fingerprint is what is being signed. This field is nullable.
    
16.  <b>platformKey</b> : The ECDSA public key of the platform/application responsible for generating the node. This field is nullable.
    

## Conclusion

The Bitcoin File System (BFS) protocol offers a novel way to store data in a tree data structure within Bitcoin OP_RETURN transaction outputs. By utilizing cryptography and a well-defined metadata structure, BFS enables secure storage, access, and verification of data on the blockchain. Its support for encryption further enhances data privacy and security.

The BFS protocol has potential applications in various domains, such as decentralized storage systems, secure data sharing, and blockchain-based applications requiring a structured data storage solution. By building on top of the existing Bitcoin infrastructure, BFS leverages the security and robustness of the Bitcoin network while providing a unique solution for data management on the blockchain.













Â©ArrorlabArts, writing supervised by GPT4
